# 다중 서버 환경에서 Session 공유법

대규모 트래픽을 처리하기 위한 Multi Server환경에서 Session 데이터의 정합성을 유지하는 방식은 3가지.

### 1. Sticky Session

> **특정 사용자가 접속을 시도했을 때 처음 접속된 서버로 계속해서 접속되도록 트래픽을 처리하는 방식**.

![11](https://user-images.githubusercontent.com/24764210/108946303-7f26e600-76a1-11eb-858a-fde3d3693bb5.png)

**장점**

- 유저는 세션이 유지되는 동안 동일한 서버만 사용하기 때문에 Session 정합성 이슈(요청한 세션아이디가 해당 웹서버의 세션아이디와 일치)에서 자유로움.

**단점**

- 고정된 세션을 사용한다는 것은 유저가 자신의 세션이 없는 다른 서버를 사용할 수 없다는 것이므로 특정 서버에 트리픽이 집중될 때 위험함.
- 서비스 중에 하나의 서버에 장애가 발생한다면 해단 서버를 사용하는 사용자은 세션 정보를 잃어버리게 되어 다시 로그인을 해야 하므로 가용성이 떨어짐.

`정합성` : 데이터가 서로 모순 없이 일관되게 일치하는 경우.





### 2. Session Clustering

> 클러스터링 : 여러 대의 컴퓨터들이 하나의 시스템처런 동작하도록 만드는 것.
>
> 웹 서버가 2대 이상 설치(Scale out)된 형태일 때 세션을 각 웹 서버의 세션저장소에 복제해두어 동일한 세션으로 관리하는 것.

![222](https://user-images.githubusercontent.com/24764210/108952484-e5fdcc80-76ac-11eb-81cd-8cf95f00abe8.png)

**장점**

- 유저가 어떤 서버에 접속하더라도 로그인 정보가 세션에 복제되어 있으므로 정합성 이슈 해결.

**단점**

- 모든 서버가 동일한 세션 객체를 가져야 하기 때문에 많은 메모리가 필요.
- 세션 저장소에 세션이 저장될 때마다 모든 서버에 입력해야 하므로 트래픽 증가로 인해 서버수가 증가할 때 성능 저하가 발생.
- 여러 대의 서버로 하나의 서비스를 위해 사용함으로써 데이터 불일치가 잠재적으로 발생할 수 있어 4개 이하 서버의 소규모 클러스터일 때 적합.



`Scale out` : 접속된 서버의 대수를 늘려 처리 능력을 향상시키는 것. (= 수평 스케일)

​						데이터 정합성 유지가 쉽고 병렬처리가 가능할 경우.

​			            ex) 메일 서버, 게시판

`Scale up` : 서버 그 자체를 증강하는 것에 의해서 처리 능력을 향상시키는 것. (= 수직 스케일)

​					  데이터 정합성 유지가 어렵고 하나의 데이터베이스에 대해 빈번한 갱신이 발생하는 경우.

​					  ex) OLTP(ATM)

- OLTP : 네트워크상의 여러 이용자가 실시간으로 데이터베이스의 데이터를 갱신하거나 조회하는 등의 단위 작업을 처리하는 방식.

![444](https://user-images.githubusercontent.com/24764210/108954015-789f6b00-76af-11eb-97eb-262036e2dfc7.PNG)





### 3. Inmemory DB를 사용한 세션 storage

> 기존 서버가 갖고 있는 세션 저장소를 이용하지 않고 별도의 세션 저장소를 사용하는 방식. (= 세션 스토리지 분리)

![333](https://user-images.githubusercontent.com/24764210/108954006-76d5a780-76af-11eb-983d-daa78d48c9f1.png)

**장점**

- 세션정보 정합성 해결, 트래픽 분산에 유용.

**단점**

- Session Storage가 한 개이기 때문에 장애 발생 시 모든 세션은 이용 불가.
- 가용성 확보를 위해 복제를 구성하는 것이 좋음.



`가용성` : 서버와 네트워크, 프로그램 등의 정보 시스템이 정상적으로 사용 가능한 정도.



#### Inmemory DB

> NoSQL 방식에 속하는 데이터베이스로 key-value방식을 사용.
>
> 데이터 스토리지의 메인 메모리에 설치되어 운영되는 방식의 데이터베이스 시스템.
>
> 예) Redis

![99797C4E5BE53C7701](https://user-images.githubusercontent.com/24764210/108956438-07fa4d80-76b3-11eb-9914-e4821377e4e1.png)


**장점**
- 디스크(Disk) 대신 주 메모리(Main Memory)를 사용함으로써, 자료 접근이 빠름.
- 메모리상에 색인을 넣어 빠른 검색이 가능.

**단점**
- 메모리가 휘발성이여서 전원이 꺼지면 자료가 삭제되므로 로그인 세션과 같은 임시 데이터에 주로 쓰임.






[자료 출처]

https://junshock5.tistory.com/84

https://m.blog.naver.com/islove8587/220548900044

https://unabated.tistory.com/entry/OLTP-OLAP

https://omty.tistory.com/14

https://toma0912.tistory.com/87

https://toma0912.tistory.com/83